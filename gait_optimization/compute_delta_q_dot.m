% check w/ book notation
clc;clear;

[L,LC,M,J,GRAV] = parameters();

Q1 = 0.4488;

DEN = -M^2*L^4*cos(Q1)^2 - 2*J*LC*L*M + 2*M^2*L^3*LC*cos(Q1)^2 ...
    - M^2*L^2*LC^2*cos(Q1)^2 + M^2*L^4 + 2*M*L^2*J - 2*M^2*L^3*LC ...
    + 2*M^2*L^2*LC^2 - 2*M^2*LC^3*L + 2*M*LC^2*J + M^2*LC^4 + J^2;
check(1,1) =  (LC*L*M - J -M*LC^2)*(M*L*LC*cos(Q1) - M*L^2*cos(Q1) ...
    + J + M*L^2 + M*LC^2 - 2*LC*L*M); 
check(1,2) = -LC*L*M*(M*L^2 + 2*J + M*L^2*cos(2*Q1) - 3*LC*L*M ...
    -2*M*L^2*cos(Q1) - M*LC*L*cos(2*Q1) - 2*M*cos(Q1)*LC^2 ...
    +4*M*L*LC*cos(Q1) + 2*M*LC^2 - 2*J*cos(Q1)); 
check(2,1) = (-J + LC*L*M -M*LC^2)*(M*L^2 + M*LC^2 + J - 2*LC*L*M);
check(2,2) = M^2*L^3*LC*cos(Q1) -3*J*LC*L*M + J*LC*L*M*cos(Q1) ...
    + M*L^2*J + M*L^2*J*cos(Q1) + M^2*LC^3*L*cos(Q1) ...
    -2*M^2*L^2*cos(Q1)*LC^2 - M^2*L^3*LC + 3*M^2*L^2*LC^2 ...
    -3*M^2*LC^3*L + 2*M*LC^2*J + M^2*LC^4 + J^2;
check=check/DEN;

% Compute alpha1 (a1)

H0 = [0 1]; c = [1 3]; H = [H0; c];
w = inv(H)*[4*(0.2244-0.0039)/(1.122+1.122); 1];
a1 = H0*check*w*((1.122+1.122)/4)*inv(c*check*w)-0.2244;

% Compute b coefficients

qp = -1.122;
qm = 1.122;
a0 = -0.2244;
a1 = -0.0501;
a2 = -0.15;
a3 = 0.0039;
a4 = 0.2244;
b = [(qm+(-1).*qp).^(-4).*(a0.*qm.^4+qp.*((-4).*a1.*qm.^3+qp.*(6.*a2.* ...
    qm.^2+(-4).*a3.*qm.*qp+a4.*qp.^2))),(-4).*(qm+(-1).*qp).^(-4).*( ...
    a0.*qm.^3+(-1).*a1.*qm.^2.*(qm+3.*qp)+qp.*(3.*a2.*qm.*(qm+qp)+qp.* ...
    (a4.*qp+(-1).*a3.*(3.*qm+qp)))),6.*(qm+(-1).*qp).^(-4).*(a0.* ...
    qm.^2+a2.*qm.^2+4.*a2.*qm.*qp+(-2).*a3.*qm.*qp+a2.*qp.^2+(-2).* ...
    a3.*qp.^2+a4.*qp.^2+(-2).*a1.*qm.*(qm+qp)),(-4).*(qm+(-1).*qp).^( ...
    -4).*(a0.*qm+3.*a2.*qm+(-1).*a3.*qm+3.*a2.*qp+(-3).*a3.*qp+a4.*qp+ ...
    (-1).*a1.*(3.*qm+qp)),(a0+(-4).*a1+6.*a2+(-4).*a3+a4).*(qm+(-1).* ...
    qp).^(-4)];